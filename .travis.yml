language: python

matrix:
  include:
  - os: linux
    python: 3.5
  - os: osx
    language: generic

install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew upgrade python; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get update; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get install ruby-dev build-essential p7zip-full rpm libusb-1.0; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install p7zip libusb qt; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then gem install fpm; fi
  - pip3 install sip pyserial pyqt5 numpy scipy matplotlib pymodbus yoctopuce
  - pip3 install requests gevent gevent-websocket qrcode openpyxl unidecode
  - pip3 install colorspacious pyusb python-snap7 bottle pyinstaller
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then pip3 install appnope pyobjc; fi
  - curl -L -O https://www.phidgets.com/downloads/phidget22/libraries/any/Phidget22Python.zip
  - unzip Phidget22Python.zip
  - "(cd Phidget22Python && python3 setup.py install)"
  - curl -L -O https://kent.dl.sourceforge.net/project/snap7/1.4.2/snap7-full-1.4.2.7z
  - 7za x snap7-full-1.4.2.7z
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then (cd snap7-full-1.4.2/build/unix && make -f x86_64_linux.mk all && sudo make -f x86_64_linux.mk install); fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then (cd snap7-full-1.4.2/build/osx && make -f x86_64_osx.mk all && sudo make -f x86_64_osx.mk LibInstall=/usr/local/lib install);  fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then curl -L -O https://www.phidgets.com/downloads/phidget22/libraries/macos/Phidget22.dmg; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then hdiutil attach Phidget22.dmg; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then sudo installer -pkg /Volumes/Phidgets22/Phidgets.pkg -target / ; fi

script:
  - cd src
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then ./build-centos-pi.sh && ./build-linux.sh; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then ./build-mac35-pi.sh; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then xvfb-run --server-args="-screen 0 1024x768x24" python artisan.py; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then python3 artisan.py; fi
  - cd ..

deploy:
  skip_cleanup: true
  provider: bintray
  file: ".bintray.json"
  user: rpaulo
  key: $BINTRAY_KEY

env:
  global:
      secure: "jw9D2pMLTGZZe8sli6rZDeXAQGYNmDHJ+ev3+xZLy7StNP0yP533Ud4X9IQV2i8eSzJ7Iua8xSpptnA5QqT9LWtSI9Wr9Mc+OOVdG3sbYEojvJWBwalcuuADpDHxaMOwyTJVFdXjxDtQkLgQCTHtWB/vgfggWbqBmpY0jtkYgWHX9GqDK747bqRUwLC5AHul6LY+GmmD4KcWf1bRP88TLHpts9IbngeibAH714YyJ+NX6TRaL+SWOQO7EK0VtUu3XEgu9PLALar48cOeGEqpVqYgeSLQzpYNrE8Jlf7DVDl5pJN4cv3dXTh37ZGTbYenQJADXhdoKTigiLI+zSRBj9bkRCFp5nC7Mjo5ypZodDQw2+rBOSWZrK5dH6g/D7Nssyw0hsmfZkSSRrgTlkd/Yulnk8aPmNSKLer39mqUaVHTcrX+CFxXtlJZvUaW569QxOnUiV6uszfbq368tXsy3BRulHhdLGFCfZfzYAvcj/fBpA8tfZOLUlovxk1pCr9Vrja4Iy3KsDATTvXUsbcppDveGrgeL0YhrDqDIZjIjBeaR9sP+XnlzgtS4UPwH6DCjBjKfgsX9TrASBerAiF14qpnpno3WF09RXVffPG0lLT3sGRYh63f+/OyP1CsfD3QPi4mEOYPw4Ns0x+eesqAIRbrKsyVfsh9Np1PvChR4gM="


version: '1.3.0.{build}'

environment:
  matrix:
    - PYTHON: "C:\\Python35-x64"
      PYTHON_VERSION: 3.5
      ARTISAN_VERSION: 1.3.0

install:
  - set PATH=%PYTHON%;%PYTHON%\\Scripts;%PATH%
  - pip install -r src\requirements.txt
  - pip install -r src\requirements-win.txt
  - curl -L -O https://download.microsoft.com/download/9/3/F/93FCF1E7-E6A4-478B-96E7-D4B285925B00/vc_redist.x64.exe
  - curl -L -O https://kent.dl.sourceforge.net/project/snap7/1.4.2/snap7-full-1.4.2.7z
  - 7z x snap7-full-1.4.2.7z
  - copy snap7-full-1.4.2\build\bin\win64\snap7.dll c:\windows
  - curl -L -O https://cfhcable.dl.sourceforge.net/project/libusb-win32/libusb-win32-releases/1.2.6.0/libusb-win32-bin-1.2.6.0.zip
  - 7z x libusb-win32-bin-1.2.6.0.zip
  - copy libusb-win32-bin-1.2.6.0\bin\amd64\libusb0.dll C:\Windows\SysWOW64
  - git clone https://github.com/pyinstaller/pyinstaller.git
  - cd pyinstaller
  - git checkout bb5d04ef8303950fa2c49767f7d909c205059c5e
  - python setup.py install
  - cd ..
  - curl -L -O https://www.dropbox.com/s/uoh3bo5q6bi0rxo/numpy-1.14.2%2Bmkl-cp35-cp35m-win_amd64.whl
  - pip install numpy-1.13.3+mkl-cp35-cp35m-win_amd64.whl
  - curl -L -O https://www.dropbox.com/s/l9m8ug8odqb6goy/scipy-1.0.1-cp35-cp35m-win_amd64.whl
  - pip uninstall scipy
  - pip install scipy-1.0.0-cp35-cp35m-win_amd64.whl

build_script:
  - cmd: cd src
  - cmd: build-win3-pi.bat
  - cmd: copy ..\LICENSE LICENSE.txt
  - cmd: 7z a artisan-win-%ARTISAN_VERSION%.zip Setup*.exe LICENSE.txt README.txt
#  - cmd: 7z a dist.zip dist

artifacts:
  - path: 'src\artisan-*.zip'
#  - path: 'src\dist.zip'

deploy:
  provider: BinTray
  username: rpaulo
  api_key:
    secure: CZTTHkcD4MGQO6Gqc5UoPdsDdiyiYfhTI6LI9eqyAzgiIAJlD5U9MctwgICalT6q
  subject: artisan
  repo: artisan-artifacts
  package: artisan
  version: master
  publish: true
  override: true
  explode: false
  
